{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.13.6/.schema/devbox.schema.json",
  "packages": [
    "nodejs@22.10.0",
    "postgresql@latest",
    "postgresql16Packages.postgis@latest"
  ],
  "shell": {
    "init_hook": ["export PS1='ðŸ“¦ devbox> '", "devbox run init"],
    "scripts": {
      "init": [
        "# Run this the first time to set up a new project",
        "if [ -d \"./pgdata\" ]; then",
        "    echo \"Project already initialized. Skipping initialization.\"",
        "    exit 0",
        "fi",
        "mkdir -p ./pgdata",
        "pg_ctl -D ./pgdata init",
        "devbox run services",
        "createuser -s -h localhost -p 5432 postgres",
        "psql -h localhost -U postgres -c \"CREATE EXTENSION IF NOT EXISTS postgis;\"",
        "npm i"
      ],
      "services": [
        "echo 'Starting postgres'",
        "pg_ctl -D ./pgdata -l logfile -o \"-c unix_socket_directories='${PWD}/pgdata'\" start",
        "echo 'All services started!'"
      ],
      "start": ["devbox run services"],
      "stop": [
        "pg_ctl -D ./pgdata stop",
        "echo 'All services stopped!'"
      ],
      "test": ["echo \"Error: no test specified\" && exit 1"]
    
    }
  }
}
